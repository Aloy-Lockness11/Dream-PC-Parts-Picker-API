@page
@model Dream_PC_Parts_Picker_Web.Pages.Parts.IndexModel
@{
    ViewData["Title"] = "Browse Parts";
}

<div class="row justify-content-center">
    <div class="col-12 col-xxl-10">

        <div class="card panel-card shadow-lg mb-3">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <h2 class="panel-title mb-0">Browse parts</h2>
                    <div class="text-muted small">Total: @Model.Parts.Count</div>
                </div>

                <form method="get" class="row g-2 mt-3" id="partsFilters">
                    <div class="col-12 col-md-3">
                        <label class="form-label">CategoryId</label>
                        <input class="form-control" type="number" name="CategoryId" value="@(Model.CategoryId?.ToString() ?? "")" placeholder="e.g. 1" />
                    </div>

                    <div class="col-12 col-md-3">
                        <label class="form-label">Sort by</label>
                        <select class="form-control" name="SortBy">
                            <option value="name" selected="@(Model.SortBy == "name")">name</option>
                            <option value="price" selected="@(Model.SortBy == "price")">price</option>
                            <option value="performance" selected="@(Model.SortBy == "performance")">performance</option>
                            <option value="tdp" selected="@(Model.SortBy == "tdp")">tdp</option>
                            <option value="manufacturer" selected="@(Model.SortBy == "manufacturer")">manufacturer</option>
                        </select>
                    </div>

                    <div class="col-12 col-md-2">
                        <label class="form-label">Direction</label>
                        <select class="form-control" name="SortDir">
                            <option value="asc" selected="@(Model.SortDir == "asc")">asc</option>
                            <option value="desc" selected="@(Model.SortDir == "desc")">desc</option>
                        </select>
                    </div>

                    <div class="col-12 col-md-4">
                        <label class="form-label">Search</label>
                        <input class="form-control" type="text" id="q" placeholder="name / manufacturer / model..." />
                    </div>

                    <div class="col-12 d-flex gap-2 mt-2">
                        <button class="btn btn-gold" type="submit">Apply</button>
                        <a class="btn btn-outline-light" href="/Parts/Index">Reset</a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card panel-card shadow-lg">
            <div class="card-body p-0">
                @if (Model.Parts.Count == 0)
                {
                    <div class="p-4 text-muted">No parts found.</div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle mb-0" id="partsTable">
                            <thead>
                            <tr>
                                <th style="min-width:260px;">Name</th>
                                <th>Category</th>
                                <th>Manufacturer</th>
                                <th>Model</th>
                                <th class="text-end">Price</th>
                                <th class="text-end">Perf</th>
                                <th class="text-end">TDP</th>
                            </tr>
                            </thead>
                            <tbody>
                            @foreach (var p in Model.Parts)
                            {
                                <tr>
                                    <td class="fw-semibold">@p.Name</td>
                                    <td class="text-muted">@p.PartCategoryName</td>
                                    <td>@p.Manufacturer</td>
                                    <td class="text-muted">@p.ModelNumber</td>
                                    <td class="text-end">@p.Price.ToString("0.00")</td>
                                    <td class="text-end">@p.PerformanceScore</td>
                                    <td class="text-end">@p.TdpWatts</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>

    </div>
</div>

@section Scripts {
<script>
    // Tiny client-side filter 🙂 keeps API calls minimal
    (function () {
        const q = document.getElementById('q');
        const table = document.getElementById('partsTable');
        if (!q || !table) return;

        const rows = Array.from(table.querySelectorAll('tbody tr'));

        q.addEventListener('input', function () {
            const term = (q.value || '').toLowerCase().trim();
            if (!term) {
                rows.forEach(r => r.style.display = '');
                return;
            }

            rows.forEach(r => {
                const text = r.innerText.toLowerCase();
                r.style.display = text.includes(term) ? '' : 'none';
            });
        });
    })();
</script>
}
