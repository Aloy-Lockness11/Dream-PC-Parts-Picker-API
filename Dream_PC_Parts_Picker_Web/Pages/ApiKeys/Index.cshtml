@page
@model Dream_PC_Parts_Picker_Web.Pages.ApiKeys.IndexModel
@{
    ViewData["Title"] = "API Keys";
}

<div class="row justify-content-center">
    <div class="col-12 col-xl-8">

        @if (!string.IsNullOrWhiteSpace(Model.FlashMessage))
        {
            <div class="alert alert-info border-0 shadow-sm">@Model.FlashMessage</div>
        }

        @if (!string.IsNullOrWhiteSpace(Model.FlashKey))
        {
            <div class="alert alert-warning border-0 shadow-sm">
                <div class="fw-bold mb-2">Key (copy now) </div>
                <div class="d-flex gap-2 align-items-center flex-wrap">
                    <code class="key-code">@Model.FlashKey</code>
                    <button class="btn btn-sm btn-gold" type="button" onclick="copyText('@Model.FlashKey')">Copy</button>
                </div>
                @if (!string.IsNullOrWhiteSpace(Model.FlashExpiry))
                {
                    <div class="text-muted small mt-2">Expires: @Model.FlashExpiry</div>
                }
            </div>
        }

        <div class="card panel-card shadow-lg mb-3">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <h2 class="panel-title mb-0">Generate key</h2>
                    <div class="text-muted small">1 key per account</div>
                </div>

                <form method="post" asp-page-handler="Generate" class="row g-2 mt-3">
                    <div class="col-12 col-md-8">
                        <input class="form-control" name="days" type="number" min="1" max="3650" value="30" />
                        <div class="text-muted small mt-1">Days until expiry</div>
                    </div>
                    <div class="col-12 col-md-4">
                        <button class="btn btn-gold w-100" type="submit">Generate</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card panel-card shadow-lg">
            <div class="card-body p-4">
                <h2 class="panel-title mb-3">Current key</h2>

                @if (Model.CurrentKey is null)
                {
                    <div class="text-muted">No key found.</div>
                }
                else
                {
                    <div class="d-flex flex-column gap-2">
                        <div>
                            <span class="text-muted">Expires:</span>
                            <span class="ms-2">@Model.CurrentKey.ExpiresAtUtc.ToString("yyyy-MM-dd HH:mm 'UTC'")</span>
                        </div>

                        <div class="d-flex gap-2 align-items-center flex-wrap">
                            <code class="key-code">@Model.CurrentKey.Key</code>
                            <button class="btn btn-sm btn-gold" type="button" onclick="copyText('@Model.CurrentKey.Key')">Copy</button>
                        </div>

                        <form method="post" asp-page-handler="Delete" class="mt-3"
                              onsubmit="return confirm('Delete the API key?');">
                            <button class="btn btn-outline-danger">Delete</button>
                        </form>
                    </div>
                }
            </div>
        </div>

    </div>
</div>

@section Scripts {
<script>
    function copyText(v) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(v);
            return;
        }
        const t = document.createElement('textarea');
        t.value = v;
        document.body.appendChild(t);
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }
</script>
}
