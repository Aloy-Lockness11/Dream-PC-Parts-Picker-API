@using Dream_PC_Parts_Picker_Web.Services
@inject AuthSession Session
@{
    var isLoggedIn = Session.IsLoggedIn;
    var name = Session.DisplayLabel;

    var path = (Context.Request.Path.Value ?? "").ToLowerInvariant();
    string Active(string startsWith) => path.StartsWith(startsWith) ? "active" : "";
    var returnUrl = Context.Request.Path.Value ?? "/";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Dream PC Parts Picker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
<div class="layout-root">
    <aside class="sidebar">
        <div class="sidebar-header">
            <span class="logo">🖥️</span>
            <span class="title">Dream PC</span>
        </div>

        <nav class="sidebar-nav">
            <a asp-page="/Index" class="nav-item @Active("/")">Home</a>

            @if (isLoggedIn)
            {
                <a asp-page="/Builds/MyBuilds" class="nav-item @Active("/builds")">My Builds</a>
                <a asp-page="/Parts/Index" class="nav-item @Active("/parts")">Browse Parts</a>
                <a asp-page="/ApiKeys/Index" class="nav-item @Active("/apikeys")">API Keys</a>
            }
        </nav>

        <div class="sidebar-footer">
            @if (isLoggedIn)
            {
                <div class="user-row">
                    <span class="user-label">Logged in as</span>
                    <span class="user-name">@name</span>
                </div>
                <a asp-page="/Auth/Logout" class="nav-item logout">Logout</a>
            }
            else
            {
                <a asp-page="/Auth/Login" asp-route-returnUrl="@returnUrl" class="nav-item">Login</a>
                <a asp-page="/Auth/Register" asp-route-returnUrl="@returnUrl" class="nav-item">Register</a>
            }
        </div>
    </aside>

    <main role="main" class="content">
        <header class="topbar">
            <h1 class="topbar-title">@ViewData["Title"]</h1>
        </header>

        <section class="content-inner container-fluid">
            @RenderBody()
        </section>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
@RenderSection("Scripts", required: false)
</body>
</html>
